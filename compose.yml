services:
  devduck-agent:
    build:
      context: ./agents
      dockerfile: Dockerfile

    models:
      llama3:
        endpoint_var: LOCAL_AGENT_BASE_URL
        model_var: LOCAL_AGENT_CHAT_MODEL
      mistral:
        endpoint_var: DEVDUCK_BASE_URL
        model_var: DEVDUCK_CHAT_MODEL

    ports:
      - 8000:8000
    environment:
      MCPGATEWAY_ENDPOINT: http://mcp-gateway:8811/sse
      PORT: 8000
      # --------------------------------------
      # Parent Agent configuration
      # --------------------------------------
      DEVDUCK_AGENT_NAME: devduck_agent
      DEVDUCK_AGENT_DESCRIPTION: Main development assistant and project coordinator
      DEVDUCK_AGENT_INSTRUCTION: |
        You are DevDuck. All your answers MUST start with "DEVDUCK SPEAKING:".
        You are a programming expert designed to coordinate Node.js experts,
        The experts are Local Agent and Cerebras.
        Local Agent can help with reading and understanding, or reviewing code.
        Cerebras agent has access to tools, can generate code, run code in a sandboxed environment, and execute CLI commands.
        - If the user specifically wants to speak with cerebras, route to the cerebras_agent.
        - If the user specifically wants to speak with local-agent, route to the local_agent.

      # --------------------------------------
      # Local Agent Configuration
      # --------------------------------------
      LOCAL_AGENT_NAME: local_agent
      LOCAL_AGENT_DESCRIPTION: Useful agent for general development tasks and project coordination
      LOCAL_AGENT_INSTRUCTION: |
        You are Local Agent. All your answers MUST start with "LOCAL_AGENT SPEAKING:".
        You are a Node.js programming expert designed to help users understand Node.js code,
        explain Node.js concepts, and review Node.js code snippets.
        You don't generate code.
        Your responses should be accurate, practical, and educational.

        ### IMPORTANT:
        1. **No Parent Agent Routing:** Do not route back to the parent agent unless the user explicitly requests it.
        2. If the user specifically wants to speak with cerebras, route to the cerebras_agent.

      # --------------------------------------
      # Cerebras Agent Configuration
      # --------------------------------------
      CEREBRAS_BASE_URL: ${CEREBRAS_BASE_URL}
      CEREBRAS_CHAT_MODEL: ${CEREBRAS_CHAT_MODEL}
      CEREBRAS_API_KEY: ${CEREBRAS_API_KEY}
      CEREBRAS_AGENT_NAME: cerebras_agent
      CEREBRAS_AGENT_DESCRIPTION: Specialized agent for advanced computational tasks and complex problem-solving
      CEREBRAS_AGENT_INSTRUCTION: |
        You are Cerebras. All your answers MUST start with "CEREBRAS SPEAKING:".
        You are a Node.js programming expert designed help create Node.js code, and generate Node.js code and projects.
        Your responses should be accurate, concise, and practical,

        ### IMPORTANT:
        1. **No Parent Agent Routing:** Do not route back to the parent agent unless the user explicitly requests it.
        2. If the user specifically wants to speak with local-agent, route to the local_agent.
    depends_on:
      - mcp-gateway

  mcp-gateway:
    # mcp-gateway secures your MCP servers
    image: docker/mcp-gateway:latest
    use_api_socket: true
    command:
      - --transport=sse
      # add any MCP servers you want to use
      - --servers=context7,node-code-sandbox
      - --catalog=/mcp-gateway-catalog.yaml
    volumes:
      - ./mcp-gateway-catalog.yaml:/mcp-gateway-catalog.yaml:ro
# NOTE: Define models
models:
  llama3:
    model: ai/llama3.2:1B-Q8_0
  mistral:
    model: ai/mistral:7B-Q4_0
